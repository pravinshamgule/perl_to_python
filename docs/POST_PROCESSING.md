# Post-Processing Module for Perl to Python Converter

This document provides detailed information about the post-processing module for the Perl to Python converter.

## Overview

The post-processing module (`post_process.py`) is designed to fix common issues in the Python code generated by the Perl to Python converter. It applies a series of transformations to the generated code to make it more Pythonic and to fix issues that the converter might not handle correctly.

## Features

The post-processing module provides the following fixes:

1. **looks_like_number Implementation**: Adds a Python implementation of Perl's `looks_like_number` function if it's used in the code.

2. **defined Syntax Fix**: Fixes incorrect 'defined' syntax in the Python code, particularly the `defi!=d` syntax error.

3. **ref Function Implementation**: Adds a Python implementation of Perl's `ref` function if it's used in the code.

4. **Numeric Operations Fix**: Ensures proper type conversion in numeric operations to prevent string concatenation instead of numeric addition.

5. **String Interpolation Fix**: Fixes string interpolation issues in print statements, particularly double curly braces in f-strings.

6. **Module Imports Fix**: Adds proper Python equivalents for Perl modules, replacing TODO comments with actual imports.

7. **unless Conditions Fix**: Fixes unless conditions that were incorrectly converted to unconditional statements.

8. **Indentation Issues Fix**: Fixes indentation issues in the Python code to ensure proper code structure.

## Usage

### Command-line Usage

You can use the post-processing module directly from the command line:

```bash
python post_process.py input_file [output_file]
```

If `output_file` is not specified, the processed code will be printed to the console.

### Programmatic Usage

You can also use the post-processing module programmatically in your Python code:

```python
from post_process import post_process_python_code, post_process_file

# Process a Python code string
python_code = "..."
processed_code = post_process_python_code(python_code)

# Or process a file
post_process_file("input.py", "output.py")
```

## Integration with the Converter

The post-processing module is automatically integrated with the Perl to Python converter. When you use the converter, it will automatically apply the post-processing fixes to the generated Python code.

If you want to disable post-processing, you can modify the `_postprocess_python_code` method in the `PerlToPythonConverter` class to not call the post-processing module.

## Examples

### Example 1: Fixing looks_like_number

Perl code:
```perl
if (looks_like_number($value)) {
    # Do something
}
```

Generated Python code (before post-processing):
```python
if looks_like_number(value):
    # Do something
```

Processed Python code (after post-processing):
```python
# Implementation of Perl's looks_like_number function
def looks_like_number(s):
    try:
        float(s)
        return True
    except (ValueError, TypeError):
        return False

if looks_like_number(value):
    # Do something
```

### Example 2: Fixing Numeric Operations

Perl code:
```perl
my $sum = $a + $b;
```

Generated Python code (before post-processing):
```python
sum = a + b  # This might concatenate strings instead of adding numbers
```

Processed Python code (after post-processing):
```python
sum = float(a) + float(b)  # This ensures numeric addition
```

### Example 3: Fixing Module Imports

Perl code:
```perl
use FindBin;
use lib $FindBin::Bin;
```

Generated Python code (before post-processing):
```python
# TODO: Import equivalent for Perl module 'FindBin'
# TODO: Import equivalent for Perl module 'lib'
```

Processed Python code (after post-processing):
```python
import os
import sys
# Add current directory to module search path
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))
```

## Customization

You can customize the post-processing module by modifying the individual fix functions in the `post_process.py` file. Each fix function is self-contained and can be modified independently.

If you want to add a new fix, you can create a new function and add it to the `post_process_python_code` function.

## Limitations

The post-processing module has the following limitations:

1. It uses regular expressions to find and replace patterns in the code, which may not handle all edge cases correctly.

2. It doesn't perform a full parse of the Python code, so it may not handle complex code structures correctly.

3. It may not fix all issues in the generated code, especially for complex Perl constructs.

## Troubleshooting

If you encounter issues with the post-processing module, you can try the following:

1. Check the generated Python code before post-processing to see if the issue is with the converter or the post-processing.

2. Try running the post-processing module separately on the generated code to see if it fixes the issue.

3. If the post-processing module doesn't fix the issue, you may need to manually fix the generated code or enhance the post-processing module.

## Contributing

Contributions to the post-processing module are welcome! If you find an issue that the post-processing module doesn't handle correctly, please consider adding a fix function and submitting a pull request.